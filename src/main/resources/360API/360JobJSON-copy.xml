<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
  <web>360API</web>
  <name>360JobJSON-copy</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>360Tools.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <author>xwiki:XWiki.Admin</author>
  <customClass/>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <creationDate>1455231600000</creationDate>
  <date>1455231600000</date>
  <contentUpdateDate>1455231600000</contentUpdateDate>
  <version>1.1</version>
  <title>360JobJSON-copy</title>
  <defaultTemplate/>
  <validationScript/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{velocity wiki="false"}}
#if("$!request.outputSyntax" != '')
  $response.setContentType('application/json')
#end
#set ($id=$request.jobId)
#set ($type=$request.type)
#set ($destCat=$request.destCat)
#if($type=="catalogusCopy" || $type=="zaaktypeCopy")
  ## Gebruik hier de Hint (copy) van de DataManager - CopyJobScriptService
  #set ($jobStatus = $services.copy.getStatus($id, "${type}"))
#elseif (($type=="catalogusExport" || $type=="zaaktypeExport" || ($type=="catalogusImport")))
  ## Gebruik hier de Hint (export) van de XMLwriter - XMLWriterJobScriptService
  #set ($jobStatus = $services.XMLProcessorJob.getStatus($id, "${type}"))
#end
#if($jobStatus)
  #set ($status = $jobStatus.getState())
  #set ($jobProgress = $jobStatus.getProgress().getCurrentLevelOffset() * 100)
  #set ($myJSONdata = { 'id': ${id}, 'status': ${status}, 'progress': ${jobProgress}, 'destinationCat': ${destCat}})
  $jsontool.serialize($myJSONdata)
#end
{{/velocity}}</content>
</xwikidoc>
